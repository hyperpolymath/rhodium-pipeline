= Rhodium Pipeline Template: Quick Start Guide
:toc: macro
:toc-title: Contents
:toclevels: 2
:sectnums:
:icons: font
:source-highlighter: rouge

Get a formally-verified data pipeline running in 5 minutes.

toc::[]

== What This Ships

This repository is a *`cargo-generate` template* — a set of https://shopify.github.io/liquid/[Liquid] template files that `cargo-generate` processes to produce a complete project skeleton.

[cols="1,3"]
|===
|What it is |A code generator template (not a library, framework, or cookiecutter)

|Template engine |https://github.com/cargo-generate/cargo-generate[cargo-generate] with Liquid syntax

|Output |A complete, buildable Rust project with Isabelle proofs, Nickel config, and justfile automation

|Determinism |Given the same input variables, produces byte-identical output
|===

When you run `cargo generate`, the template engine:

1. Prompts for variable values (or accepts them via `--define`)
2. Substitutes `{{variable}}` placeholders throughout all template files
3. Applies conditionals (e.g., excludes Julia files if `include_julia=false`)
4. Writes the rendered files to your new project directory

== Prerequisites

Ensure these tools are installed:

[cols="1,2,2"]
|===
|Tool |Purpose |Install Command

|Rust 1.80+
|Core implementation
|`curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs \| sh`

|cargo-generate
|Project generation
|`cargo install cargo-generate`

|just
|Task automation
|`cargo install just`

|Nickel
|Type-safe configuration
|`cargo install nickel-lang-cli`

|Guile 3.0+
|Runtime validation
|`apt install guile-3.0` or `brew install guile`

|Isabelle
|Formal proofs
|Download from https://isabelle.in.tum.de
|===

== Generate a New Project

=== Interactive Mode

[source,bash]
----
# Generate from template (prompts for each variable)
cargo generate --git https://gitlab.com/hyperpolymath/rhodium-pipeline-template
----

=== Deterministic Mode (Reproducible)

For CI/CD, scripting, or reproducible builds, specify all variables on the command line:

[source,bash]
----
cargo generate --git https://gitlab.com/hyperpolymath/rhodium-pipeline-template \
  --name my-pipeline \
  --define project_name=my_pipeline \
  --define ProjectName=MyPipeline \
  --define description="My data processing pipeline" \
  --define author="Your Name" \
  --define email="you@example.com" \
  --define license=MIT \
  --define include_julia=false \
  --define checksum_algo=blake3 \
  --define isabelle_version=Isabelle2024 \
  --define min_rust_version=1.75.0 \
  --define default_threads=4 \
  --define enable_telemetry=false \
  --define target_platforms="linux-x86_64,macos-arm64"
----

This produces byte-identical output given the same inputs. All 13 template variables are:

[cols="2,1,2"]
|===
|Variable |Type |Default

|`project-name` |string |(required, via `--name`)
|`project_name` |string |(required)
|`ProjectName` |string |(required)
|`description` |string |(required)
|`author` |string |`Anonymous`
|`email` |string |`dev@example.com`
|`license` |choice |`AGPL-3.0` (or `MIT`)
|`include_julia` |bool |`false`
|`checksum_algo` |choice |`blake3`
|`isabelle_version` |string |`Isabelle2024`
|`min_rust_version` |string |`1.75.0`
|`default_threads` |string |`4`
|`enable_telemetry` |bool |`false`
|`target_platforms` |string |`linux-x86_64,macos-arm64,macos-x86_64`
|===

== Reference Example (Verifiable)

Generate a reference pipeline to verify the template compiles and tests pass:

[source,bash]
----
# Generate the reference project with fixed values
cargo generate --git https://gitlab.com/hyperpolymath/rhodium-pipeline-template \
  --name ref-pipeline \
  --define project_name=ref_pipeline \
  --define ProjectName=RefPipeline \
  --define description="Reference pipeline for verification" \
  --define author="Test" \
  --define email="test@example.com" \
  --define license=MIT \
  --define include_julia=false \
  --define checksum_algo=blake3 \
  --define isabelle_version=Isabelle2024 \
  --define min_rust_version=1.75.0 \
  --define default_threads=4 \
  --define enable_telemetry=false \
  --define target_platforms="linux-x86_64"

cd ref-pipeline

# Verify it compiles
cargo check

# Run unit tests (no external deps required)
cargo test --lib

# Build release binary
cargo build --release

# Verify CLI works
./target/release/ref-pipeline --help
./target/release/ref-pipeline --version
----

Expected output from `--help`:

[source]
----
Reference pipeline for verification

Usage: ref-pipeline [OPTIONS] <COMMAND>

Commands:
  run          Run the data processing pipeline
  validate     Validate data without processing
  config       Manage configuration
  checksum     Checksum operations
  completions  Generate shell completions
  manpage      Generate man page
  help         Print this message or the help of the given subcommand(s)
...
----

== Enter Your Project

[source,bash]
----
cd my-pipeline

# Verify dependencies
just check-deps

# You should see:
# ✓ Rust OK
# ✓ Nickel OK
# ✓ Guile OK
# ✓ Isabelle OK
# All dependencies satisfied
----

== Build and Test

[source,bash]
----
# Build the project
just build

# Run tests
just test

# Quick development cycle
just quick
# This runs: fmt-check → check → test-unit
----

== Verify Proofs

[source,bash]
----
# Check all Isabelle proofs
just prove

# Quick proof check (faster)
just prove-fast

# You should see:
# Building Isabelle session...
# Finished MyPipeline (0:00:XX elapsed time)
----

== Run Your Pipeline

[source,bash]
----
# Dry run (no output)
just run-dry --input ./data --output ./results

# Actual run
just run --input ./data --output ./results

# Verbose mode
just run-verbose --input ./data --output ./results -vvv
----

== Validate Configuration

[source,bash]
----
# Check Nickel configuration
just validate-config

# Export configuration as JSON
just config-export

# Show effective configuration
just config-show
----

== Project Structure

Your generated project:

[source]
----
my-pipeline/
├── Cargo.toml              # Rust dependencies
├── src/
│   ├── main.rs             # CLI entry point
│   ├── cli.rs              # Argument definitions
│   ├── pipeline.rs         # Core logic
│   └── ...
├── proofs/
│   ├── ROOT                # Isabelle session
│   ├── MyPipeline_*.thy    # Formal proofs
├── config/
│   ├── default.ncl         # Main configuration
│   ├── schema.ncl          # Configuration schema
│   └── presets.ncl         # Pre-defined presets
├── schemes/
│   └── config.scm          # Guile runtime config
├── justfile                # Task automation
└── docs/
----

== Key Commands

[cols="1,2"]
|===
|Command |Description

|`just help`
|Show all available commands

|`just quick`
|Fast development cycle

|`just full`
|Complete validation pipeline

|`just ci`
|CI/CD pipeline checks

|`just prove`
|Verify Isabelle proofs

|`just validate`
|Validate all configurations

|`just test`
|Run all tests

|`just lint`
|Code quality checks

|`just fmt`
|Format code

|`just build`
|Development build

|`just release`
|Optimized release build

|`just run`
|Execute pipeline

|`just run-dry`
|Simulate without writing
|===

== Configuration

=== Using Presets

[source,bash]
----
# Development preset (fast, minimal validation)
export MY_PIPELINE_PRESET=dev
just run --input ./data --output ./results

# Production preset (full validation)
export MY_PIPELINE_PRESET=prod
just run --input ./data --output ./results

# Paranoid preset (maximum validation + proofs)
export MY_PIPELINE_PRESET=paranoid
just run --input ./data --output ./results
----

=== Environment Variables

[source,bash]
----
# Override thread count
export MY_PIPELINE_THREADS=8

# Set validation level
export MY_PIPELINE_VALIDATION=full

# Enable strict mode
export MY_PIPELINE_STRICT=true
----

=== Configuration File

[source,bash]
----
# Initialize user config
just config-init

# Edit configuration
$EDITOR ~/.config/my-pipeline/config.json
----

== Adding Your Logic

=== 1. Define Your Data Type

Edit `src/pipeline.rs`:

[source,rust]
----
// Replace the placeholder Record type
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Record {
    pub id: String,
    pub field1: String,
    pub field2: i64,
    // Add your fields
}
----

=== 2. Implement Transformation

Edit `src/pipeline.rs`:

[source,rust]
----
async fn transform_record(&self, record: Record) -> Result<Record> {
    // Your transformation logic here
    Ok(Record {
        id: record.id,
        field1: record.field1.to_uppercase(),
        field2: record.field2 * 2,
    })
}
----

=== 3. Add Your Proofs

Edit `proofs/MyPipeline_Invariants.thy`:

[source,isabelle]
----
(* Your domain-specific invariant *)
definition my_invariant :: "dataset \<Rightarrow> bool" where
  "my_invariant ds \<equiv> \<forall>r \<in> ds. field2 r > 0"

lemma processing_preserves_my_invariant:
  assumes "my_invariant ds"
  shows "my_invariant (transform ds)"
  (* Your proof here *)
----

=== 4. Run Full Pipeline

[source,bash]
----
# Build, test, prove, validate
just full

# If everything passes, run for real
just run --input ./data --output ./results
----

== Troubleshooting

=== Proof Fails

[source,bash]
----
# Get detailed proof output
isabelle build -v -d proofs/ MyPipeline

# Open in Isabelle/jEdit for interactive debugging
just prove-edit MyPipeline_Invariants
----

=== Configuration Errors

[source,bash]
----
# Validate configuration
nickel typecheck config/default.ncl

# Show effective configuration
just config-show
----

=== Build Errors

[source,bash]
----
# Check without building
just check

# Verbose build
cargo build -v
----

== Next Steps

1. **Read the methodology** — link:HANDOVER.adoc[HANDOVER.adoc] explains the philosophy
2. **Study the proofs** — Understand the invariant patterns in `proofs/`
3. **Customize configuration** — Adjust `config/default.ncl` for your needs
4. **Add your logic** — Implement domain-specific processing
5. **Write your proofs** — Add invariants for your domain

== Getting Help

* Template repository: https://gitlab.com/hyperpolymath/rhodium-pipeline-template
* Reference implementation: https://gitlab.com/hyperpolymath/zerostep
* Isabelle documentation: https://isabelle.in.tum.de/documentation.html
* Nickel documentation: https://nickel-lang.org/user-manual/

---

_Built with Rhodium Pipeline Template v1.0.0_
